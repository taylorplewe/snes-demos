name: Transition issue to In Review

on:
  pull_request:
    types:
      - assigned

jobs:
  move_issue:
    runs-on: ubuntu-latest
    steps:
      - name: Move issue to "In review"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh api graphql -f query='
            query($repoId: ID!, $prId: ID!) {
              repository(id: $repoId) {
                pullRequest(id: $prId) {
                  closingIssuesReferences(first: 1) {
                    nodes: {
                      id
                      title
                    }
                  }
                }
              }
            }
          ' -F repoId=${{ github.repository_id }} -F prId=${{ github.event.pull_request.id }}

          echo 'issue id:'
          echo $(jq '.data.repository.pullRequest.closingIssuesReferences.nodes[0].id)
          echo 'issue title:'
          echo $(jq '.data.repository.pullRequest.closingIssuesReferences.nodes[0].title)
